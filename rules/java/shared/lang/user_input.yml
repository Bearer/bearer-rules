type: shared
languages:
  - java
patterns:
  - pattern: $<REQUEST>.$<METHOD>($<...>)
    filters:
      - either:
          - variable: REQUEST
            type: javax.servlet.http.HttpServletRequest
          - variable: REQUEST
            type: javax.servlet.ServletRequest
      - variable: METHOD
        values:
          - getCookies
          - getHeader
          - getHeaders
          - getRequestURI
          - getRequestURL
          - getAttribute
          - getInputStream
          - getQueryString
          - getParameter
          - getParameterMap
          - getParameterNames
          - getParameterValues
          - getReader
          - getHeaderNames
          - getPart
          - getParts
  - pattern: $<COOKIE>.getValue()
    filters:
      - either:
          # FIXME: remove this, but we need array support to cover the path traversal test cases
          - variable: COOKIE
            detection: java_shared_lang_user_input_cookies
            scope: result
          - variable: COOKIE
            type: javax.servlet.http.Cookie
  - pattern: $<PARAM_MAP>.get($<_>)
    filters:
      - variable: PARAM_MAP
        detection: java_shared_lang_user_input_param_map
        scope: cursor
auxiliary:
  - id: java_shared_lang_user_input_cookies
    patterns:
      - pattern: $<REQUEST>.getCookies()
        filters:
          - either:
              - variable: REQUEST
                type: javax.servlet.http.HttpServletRequest
              - variable: REQUEST
                type: javax.servlet.ServletRequest
  - id: java_shared_lang_user_input_param_map
    patterns:
      - pattern: $<REQUEST>.getParameterMap()
        filters:
          - either:
              - variable: REQUEST
                type: javax.servlet.http.HttpServletRequest
              - variable: REQUEST
                type: javax.servlet.ServletRequest
metadata:
  description: "Java user input."
  id: java_shared_lang_user_input
