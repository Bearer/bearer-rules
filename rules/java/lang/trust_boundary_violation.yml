patterns:
  - pattern: $<REQUEST>.setAttribute($<NAME>, $<VALUE>)
    filters:
      - either:
          - variable: REQUEST
            type: javax.servlet.ServletRequest
          - variable: REQUEST
            type: javax.servlet.http.HttpServletRequest
      - either:
          - not:
              variable: NAME
              detection: java_lang_trust_boundary_violation_literal
              scope: cursor
          - not:
              variable: VALUE
              detection: java_lang_trust_boundary_violation_literal
              scope: cursor
  - pattern: $<SESSION>.$<METHOD>($<NAME>, $<VALUE>)
    filters:
      - variable: SESSION
        detection: java_lang_trust_boundary_violation_session
        scope: cursor
      - variable: METHOD
        values:
          - setAttribute
          - putValue
      - either:
          - not:
              variable: NAME
              detection: java_lang_trust_boundary_violation_literal
              scope: cursor
          - not:
              variable: VALUE
              detection: java_lang_trust_boundary_violation_literal
              scope: cursor
auxiliary:
  - id: java_lang_trust_boundary_violation_session
    patterns:
      - pattern: $<_>
        filters:
          - type: javax.servlet.http.HttpSession
      - pattern: $<REQUEST>.getSession()
        filters:
          - either:
              - variable: REQUEST
                type: javax.servlet.ServletRequest
              - variable: REQUEST
                type: javax.servlet.http.HttpServletRequest
  - id: java_lang_trust_boundary_violation_literal
    patterns:
       - pattern: $<VALUE>
         filters:
           - not:
               variable: VALUE
               string_regex: �
languages:
  - java
severity: warning
metadata:
  description: "Trust boundary violation detected."
  remediation_message: |
    ## Description

    Mixing trusted and untrusted data inside the same data structure can lead
    to untrusted data being mistakenly treated as being trusted.

    ## Remediations

    ✅ Avoid adding trusted data to data structures containing untrusted data
  cwe_id:
    - 501
  id: java_lang_trust_boundary_violation
  documentation_url: https://docs.bearer.com/reference/rules/java_lang_trust_boundary_violation
